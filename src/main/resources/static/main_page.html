<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@500;700&family=Judson&display=swap" rel="stylesheet">
  
  <title>DomuSwap</title>
  <link rel="stylesheet" href="styles/common.css">
  <link rel="stylesheet" href="styles/main_page.css"/>
</head>
<body>

<header>
  <div class="header-left">
    <img src="images/logo_white.png" alt="DomuSwap Logo" class="middle-logo">
    <h1 style="margin: 0; font-size: 1.5rem;" class="logo-text">DomuSwap</h1>
  </div>

  <nav>
    <a class="nav-button" href="#about">About Us</a>
    <a class="nav-button" href="#faq">FAQ</a>
    <a class="nav-button" href="#contact">Contact Us</a>
  </nav>

  <div class="account-box">
    <span class="account-text">Sign in</span>
  </div>
</header>


<!-- Modal -->
<div id="loginModal" class="modal">
  <div class="modal-content">
	<span class="close" onclick="closeModal()">&times;</span>
    <h2 id="modalTitle">Login to DomuSwap</h2>
    
    <!-- Toggle between Login and SignUp forms -->
    <div id="loginFormContainer">
      <form id="loginForm">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Enter your email" required />
        
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter your password" required />

        <button type="submit">Login</button>
      </form>
      
      <!-- Sign-Up Option Link -->
      <p>Don't have an account? <a href="#" onclick="showSignUp()">Sign Up</a></p>
    </div>

    <!-- Sign-Up Form (Initially Hidden) -->
    <div id="signUpFormContainer" style="display: none;">
    <label for="userRole">I am a:</label>
		<select id="userRole" required>
		  <option value="">-- Select Role --</option>
		  <option value="customer">Customer</option>
		  <option value="owner">Owner</option>
		</select>
    
      <form id="signUpForm">
        <label for="fullName">Full Name</label>
        <input type="text" id="fullName" placeholder="Enter your full name" required />

        <label for="signUpEmail">Email</label>
        <input type="email" id="signUpEmail" placeholder="Enter your email" required />

        <label for="signUpPassword">Password</label>
        <input type="password" id="signUpPassword" placeholder="Create a password" required />

        <button type="submit">Sign Up</button>
      </form>
      
      <!-- Login Option Link -->
      <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
    </div>
  </div>
</div>


<main>
  <h1 class="hero-heading">Stay In a Home, <br>Not a Hotel.</h1>

  <div class="search-bar">
    <div class="search-field">
      <label for="location">Destination</label>
      <input id="location" type="text" placeholder="Enter location" />
    </div>
    <div class="search-field">
      <label for="check-in">Check-In</label>
      <input id="check-in" type="date" placeholder="YYYY-MM-DD" />
    </div>
    <div class="search-field">
      <label for="check-out">Check-Out</label>
      <input id="check-out" type="date" placeholder="YYYY-MM-DD" />
    </div>
    <div class="search-field">
      <label for="person">Person</label>
      <input id="person" type="number" min="1" placeholder="Number of persons" />
    </div>
    <button class="search-btn" onclick="handleSearch()">üîç</button>
  </div>
</main>

<footer>
  <div class="footer-section" id="about">
    <h2>About Us</h2>
    <p>
      Welcome to Home Exchange Manager, the platform where travel meets trust, community, and comfort.
      Our platform empowers homeowners around the world to exchange homes for short stays‚Äîcompletely free of charge‚Äîin exchange for agreed-upon services that help care for each other's spaces.
      This service-based model means that instead of paying rent, guests contribute through helpful tasks defined by the homeowner. These can include watering plants in Paris, caring for pets in Prague, or maintaining a beachside home in Bali‚Äîcreating a more meaningful, respectful, and cooperative travel experience.
      Every exchange comes with a unique local perspective and a shared understanding of responsibility. At Home Exchange Manager, we don‚Äôt just connect homes‚Äîwe connect lifestyles, cultures, and values.
      Our mission is to make travel more sustainable, more personal, and more human.
    </p>
  </div>

  <div class="footer-section" id="faq">
    <h2>FAQ</h2>
    <p>
      <strong>1. Is home exchange really free?</strong><br>
      Yes! All exchanges on our platform are 100% free. Instead of paying, guests agree to provide services (like watering plants or feeding pets) and respect the homeowner's listed rules and limitations.<br><br>

      <strong>2. What kinds of services might I be asked to provide?</strong><br>
      Services can include caring for pets, watering plants, or keeping the home clean. Each homeowner can define what they need, and guests can review these before booking.<br><br>

      <strong>3. What kind of rules or constraints do homes have?</strong><br>
      Homeowners may set rules such as "no smoking," "no pets," or limits like "no more than two children." These help ensure mutual respect between hosts and guests.<br><br>

      <strong>4. How do I create a listing for my home?</strong><br>
      Once you're registered, go to your dashboard and click ‚ÄúAdd Housing.‚Äù You‚Äôll be able to upload photos, describe your space, list available dates, define services, and add any house rules.<br><br>

      <strong>5. Can I message other users directly?</strong><br>
      Yes! We have a built-in messaging system so you can communicate securely with other members before, during, or after an exchange.<br><br>

      <strong>6. What happens when I receive a booking request?</strong><br>
      You‚Äôll be notified immediately and can choose to accept, decline, or request more information. You're always in control.<br><br>

      <strong>7. Is there a way to rate members?</strong><br>
      Yes! After each exchange, both hosts and guests can rate each other. Ratings help build trust and accountability in the community.<br><br>

      <strong>8. What if I have a problem or need help?</strong><br>
      Our support team is always here for you. You can reach out via the Contact Us page or message us directly from your profile dashboard.
    </p>
  </div>

  <div class="footer-section" id="contact">
    <h2>Contact Us</h2>
    <p>
      Got a question? Need support?<br>
      We‚Äôre here to help.<br><br>

      üìß <strong>Email:</strong> support@homeexchangemanager.com<br>
      üåê <strong>Website:</strong> www.homeexchangemanager.com<br>
      üí¨ <strong>Messaging:</strong> Use the chat widget at the bottom-right corner of the platform to talk to our support team directly.<br><br>

      <strong>Office Hours:</strong><br>
      Monday to Friday: 9:00 AM ‚Äì 6:00 PM (UTC)<br>
      Saturday and Sunday: Email Support Only<br><br>
      We believe in the power of community and personal connection, so don‚Äôt hesitate to get in touch. We‚Äôre always happy to hear from you.
    </p>
  </div>
</footer>

<script>
//Switch to Sign Up form
  function showSignUp() {
    document.getElementById('modalTitle').textContent = "Sign Up for DomuSwap"; // Update title
    document.getElementById('loginFormContainer').style.display = 'none'; // Hide login form
    document.getElementById('signUpFormContainer').style.display = 'block'; // Show sign-up form
  }

  // Switch to Login form
  function showLogin() {
    document.getElementById('modalTitle').textContent = "Login to DomuSwap"; // Update title
    document.getElementById('signUpFormContainer').style.display = 'none'; // Hide sign-up form
    document.getElementById('loginFormContainer').style.display = 'block'; // Show login form
  }

  // Submit Login Form
  document.getElementById('loginForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    console.log('Login attempt:', email, password);
    closeModal();
  });

  // Submit Sign Up Form
  document.getElementById('signUpForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const fullName = document.getElementById('fullName').value;
    const signUpEmail = document.getElementById('signUpEmail').value;
    const signUpPassword = document.getElementById('signUpPassword').value;
    const userRole = document.getElementById('userRole').value; // ‚úÖ new line
    console.log('Sign Up attempt:', fullName, signUpEmail, signUpPassword);
    closeModal();
  });

  // Close Modal
  function closeModal() {
    document.getElementById('loginModal').style.display = 'none';
  }

  // Close modal when clicking outside
  window.onclick = function (event) {
    const modal = document.getElementById('loginModal');
    if (event.target === modal) {
      closeModal();
    }
  };

  // Allow Enter key to trigger search
  document.querySelector('.search-bar').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      handleSearch();
    }
  });
//LOGIN HANDLER
document.getElementById('loginForm').addEventListener('submit', function (e) {
  e.preventDefault();

  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

  fetch('http://localhost:8080/api/users/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  })
  .then(response => {
    if (response.ok) return response.json();
    throw new Error('Login failed');
  })
  .then(user => {
    localStorage.setItem('loggedInUser', JSON.stringify(user));
    localStorage.setItem('userRole', user.role);
    updateAccountUI(user.name);
    closeModal();
  })
  .catch(error => {
    console.error('Login error:', error);
    alert('‚ùå Login failed. Please check credentials.');
  });
});


//login replace when signed in
function updateAccountUI(name) {
  const role = localStorage.getItem('userRole');

  let accountLink = '#'; // default in case role is missing
  if (role === 'owner') {
    accountLink = 'owner.html';
  } else if (role === 'customer') {
    accountLink = 'customer.html';
  }

  const accountBox = document.querySelector('.account-box');
  accountBox.innerHTML = `
    <a href="${accountLink}" class="account-name">üë§ ${name}</a>
    <button class="logout-button" onclick="logout()">Logout</button>
  `;
}


function logout() {
  localStorage.removeItem('loggedInUser');
  location.reload(); // refresh to reset UI
}

// On page load: check if already logged in
document.addEventListener('DOMContentLoaded', () => {
  const user = JSON.parse(localStorage.getItem('loggedInUser'));

  if (user) {
    updateAccountUI(user.name);
  } else {
    // Only attach modal-open handler if not logged in
    document.querySelector('.account-box').addEventListener('click', function () {
      document.getElementById('loginModal').style.display = 'block';
    });
  }
});



	// SIGNUP HANDLER
document.getElementById('signUpForm').addEventListener('submit', function (e) {
  e.preventDefault();

  const fullName = document.getElementById('fullName').value;
  const signUpEmail = document.getElementById('signUpEmail').value;
  const signUpPassword = document.getElementById('signUpPassword').value;
  const userRole = document.getElementById('userRole').value;

  fetch('http://localhost:8080/api/users/signup', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      name: fullName,
      email: signUpEmail,
      password: signUpPassword,
      role: userRole
    })
  })
  .then(response => {
    if (response.ok) return response.json();
    else throw new Error('Signup failed');
  })
  alert('‚úÖ Account created successfully! Please log in.');
  showLogin(); // show login form
})
  .catch(error => {
    console.error('Signup error:', error);
    alert('‚ùå Signup failed.');
  });



  
  //search bar
	function handleSearch() {
	  const location = document.getElementById('location').value;
	  const checkIn = document.getElementById('check-in').value;
	  const checkOut = document.getElementById('check-out').value;
	  const person = document.getElementById('person').value;
	
	  const today = new Date();
	  today.setHours(0, 0, 0, 0); // strip time part
	  const checkInDate = new Date(checkIn);
	  const checkOutDate = new Date(checkOut);
	
	  // ‚úÖ Prevent past check-in
	  if (checkIn && checkInDate < today) {
	    alert('‚ùå Check-in date cannot be in the past.');
	    return;
	  }
	
	  // ‚úÖ Prevent check-out before check-in
	  if (checkIn && checkOut && checkOutDate < checkInDate) {
	    alert('‚ùå Check-out date cannot be before check-in date.');
	    return;
	  }
	
	  // ‚úÖ Save + continue to fetch
	  localStorage.setItem('searchFormData', JSON.stringify({
	    location,
	    checkIn,
	    checkOut,
	    person
	  }));
	
	  fetch(`http://localhost:8080/api/housing/search?location=${encodeURIComponent(location)}&checkIn=${checkIn}&checkOut=${checkOut}&person=${person}`)
	    .then(response => response.json())
	    .then(results => {
	      localStorage.setItem('searchResults', JSON.stringify(results));
	      window.location.href = 'house_selection.html';
	    })
	    .catch(error => {
	      console.error('Search error:', error);
	      alert('‚ùå Error fetching housing results');
	    });
	}
</script>

</body>
</html>
