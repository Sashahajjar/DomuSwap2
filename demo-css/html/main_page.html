<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@500;700&family=Judson&display=swap" rel="stylesheet">
  
  <title>DomuSwap - Home</title>
  <link rel="stylesheet" href="../css/domuswap.css">
</head>
<body>

<header class="header">
  <div class="container">
    <div class="header-content">
      <div class="header-left">
        <img src="../images/logo_white.png" alt="DomuSwap Logo" class="middle-logo">
        <h1 class="logo-text">DomuSwap</h1>
      </div>

      <nav class="nav">
        <a href="#about" class="nav-link">About Us</a>
        <a href="#faq" class="nav-link">FAQ</a>
        <a href="#contact" class="nav-link">Contact Us</a>
      </nav>

      <button class="btn btn-primary" onclick="openModal()">Sign in</button>
    </div>
  </div>
</header>

<main class="main">
  <div class="container">
    <section class="section hero">
      <h1 class="text-4xl font-bold mb-4">Stay In a Home,<br>Not a Hotel.</h1>
      
      <div class="search-bar card p-6">
        <div class="grid grid-cols-4 gap-4">
          <div class="form-group">
            <label class="form-label">Destination</label>
            <input type="text" class="form-control" placeholder="Enter location" />
          </div>
          <div class="form-group">
            <label class="form-label">Check-In</label>
            <input type="date" class="form-control" placeholder="YYYY-MM-DD" />
          </div>
          <div class="form-group">
            <label class="form-label">Check-Out</label>
            <input type="date" class="form-control" placeholder="YYYY-MM-DD" />
          </div>
          <div class="form-group">
            <label class="form-label">Person</label>
            <input type="number" class="form-control" min="1" placeholder="Number of persons" />
          </div>
        </div>
        <button class="btn btn-primary mt-4 w-full">
          <span class="icon">üîç</span>
          Search
        </button>
      </div>
    </section>
  </div>
</main>

<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section" id="about">
        <h2>About Us</h2>
        <p>
          Welcome to Home Exchange Manager, the platform where travel meets trust, community, and comfort.
          Our platform empowers homeowners around the world to exchange homes for short stays‚Äîcompletely free of charge‚Äîin exchange for agreed-upon services that help care for each other's spaces.
          This service-based model means that instead of paying rent, guests contribute through helpful tasks defined by the homeowner. These can include watering plants in Paris, caring for pets in Prague, or maintaining a beachside home in Bali‚Äîcreating a more meaningful, respectful, and cooperative travel experience.
          Every exchange comes with a unique local perspective and a shared understanding of responsibility. At Home Exchange Manager, we don't just connect homes‚Äîwe connect lifestyles, cultures, and values.
          Our mission is to make travel more sustainable, more personal, and more human.
        </p>
      </div>

      <div class="footer-section" id="faq">
        <h2>FAQ</h2>
        <div class="faq-list">
          <div class="faq-item">
            <h3>Is home exchange really free?</h3>
            <p>Yes! All exchanges on our platform are 100% free. Instead of paying, guests agree to provide services and respect the homeowner's listed rules.</p>
          </div>
          <div class="faq-item">
            <h3>What kinds of services might I be asked to provide?</h3>
            <p>Services can include caring for pets, watering plants, or keeping the home clean. Each homeowner can define what they need, and guests can review these before booking.</p>
          </div>
          <div class="faq-item">
            <h3>What kind of rules or constraints do homes have?</h3>
            <p>Homeowners may set rules such as "no smoking," "no pets," or limits like "no more than two children." These help ensure mutual respect between hosts and guests.</p>
          </div>
          <div class="faq-item">
            <h3>How do I create a listing for my home?</h3>
            <p>Once you're registered, go to your dashboard and click "Add Housing." You'll be able to upload photos, describe your space, list available dates, define services, and add any house rules.</p>
          </div>
          <div class="faq-item">
            <h3>Can I message other users directly?</h3>
            <p>Yes! We have a built-in messaging system so you can communicate securely with other members before, during, or after an exchange.</p>
          </div>
          <div class="faq-item">
            <h3>What happens when I receive a booking request?</h3>
            <p>You'll be notified immediately and can choose to accept, decline, or request more information. You're always in control.</p>
          </div>
          <div class="faq-item">
            <h3>Is there a way to rate members?</h3>
            <p>Yes! After each exchange, both hosts and guests can rate each other. Ratings help build trust and accountability in the community.</p>
          </div>
          <div class="faq-item">
            <h3>What if I have a problem or need help?</h3>
            <p>Our support team is always here for you. You can reach out via the Contact Us page or message us directly from your profile dashboard.</p>
          </div>
        </div>
      </div>

      <div class="footer-section" id="contact">
        <h2>Contact Us</h2>
        <p>
          Got a question? Need support?<br>
          We're here to help.<br><br>
          üìß <strong>Email:</strong> support@homeexchangemanager.com<br>
          üåê <strong>Website:</strong> www.homeexchangemanager.com<br>
          üí¨ <strong>Messaging:</strong> Use the chat widget at the bottom-right corner of the platform to talk to our support team directly.<br><br>
          <strong>Office Hours:</strong><br>
          Monday to Friday: 9:00 AM ‚Äì 6:00 PM (UTC)<br>
          Saturday and Sunday: Email Support Only<br><br>
          We believe in the power of community and personal connection, so don't hesitate to get in touch. We're always happy to hear from you.
        </p>
      </div>
    </div>
  </div>
</footer>

<!-- Login Modal -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Login to DomuSwap</h2>
      <button class="modal-close" onclick="closeModal()">&times;</button>
    </div>
    
    <div id="loginFormContainer">
      <form id="loginForm" class="form">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" placeholder="Enter your email" required />
        </div>
        
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" placeholder="Enter your password" required />
        </div>
        
        <div class="text-right mb-4">
          <a href="#" class="text-primary" onclick="showForgotPassword()">Forgot password?</a>
        </div>
        
        <button type="submit" class="btn btn-primary w-full">Login</button>
      </form>
      
      <p class="text-center mt-4">
        Don't have an account? <a href="#" class="text-primary" onclick="showSignUp()">Sign Up</a>
      </p>
    </div>
  </div>
</div>

<script>
//Switch to Sign Up form
function showSignUp() {
  document.getElementById('modalTitle').textContent = "Sign Up for DomuSwap"; // Update title
  document.getElementById('loginFormContainer').style.display = 'none'; // Hide login form
  document.getElementById('signUpFormContainer').style.display = 'block'; // Show sign-up form
}

// Switch to Login form
function showLogin() {
  document.getElementById('modalTitle').textContent = "Login to DomuSwap"; // Update title
  document.getElementById('signUpFormContainer').style.display = 'none'; // Hide sign-up form
  document.getElementById('loginFormContainer').style.display = 'block'; // Show login form
}

// Submit Login Form
document.getElementById('loginForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  console.log('Login attempt:', email, password);
  closeModal();
});

// Submit Sign Up Form
document.getElementById('signUpForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const fullName = document.getElementById('fullName').value;
  const signUpEmail = document.getElementById('signUpEmail').value;
  const signUpPassword = document.getElementById('signUpPassword').value;
  const userRole = document.getElementById('userRole').value; // ‚úÖ new line
  console.log('Sign Up attempt:', fullName, signUpEmail, signUpPassword);
  closeModal();
});

// Close Modal
function closeModal() {
  document.getElementById('loginModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function (event) {
  const modal = document.getElementById('loginModal');
  if (event.target === modal) {
    closeModal();
  }
};

// Allow Enter key to trigger search
document.querySelector('.search-bar').addEventListener('keypress', function (e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    handleSearch();
  }
});

//login replace when signed in
function updateAccountUI(name) {
  const role = localStorage.getItem('userRole');
  let accountLink = '#'; // default in case role is missing
  if (role === 'owner') {
    accountLink = 'owner.html';
  } else if (role === 'customer') {
    accountLink = 'customer.html';
  }
  const accountBox = document.querySelector('.account-box');
  accountBox.innerHTML = `
    <a href="${accountLink}" class="account-name">üë§ ${name}</a>
    <button class="logout-button" onclick="logout()">Logout</button>
  `;
}

function logout() {
  localStorage.removeItem('loggedInUser');
  location.reload(); // refresh to reset UI
}

document.addEventListener('DOMContentLoaded', function() {
  // Always hide login modal on page load
  document.getElementById('loginModal').style.display = 'none';

  // LOGIN HANDLER
  document.getElementById('loginForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    fetch('http://localhost:8080/api/users/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    })
    .then(response => {
      if (response.ok) return response.json();
      throw new Error('Login failed');
    })
    .then(user => {
      localStorage.setItem('loggedInUser', JSON.stringify(user));
      localStorage.setItem('userRole', user.role);
      updateAccountUI(user.name);
      closeModal();
    })
    .catch(error => {
      console.error('Login error:', error);
      alert('‚ùå Login failed. Please check credentials.');
    });
  });

  // On page load: check if already logged in
  const user = JSON.parse(localStorage.getItem('loggedInUser'));
  if (user) {
    updateAccountUI(user.name);
  } else {
    // Only attach modal-open handler if not logged in
    const accountBox = document.querySelector('.account-box');
    if (accountBox) {
      accountBox.addEventListener('click', function (e) {
        // Only open modal if the user clicks the 'Sign in' span
        if (e.target.classList.contains('account-text')) {
          document.getElementById('loginModal').style.display = 'block';
        }
      });
    }
  }

  // SIGNUP HANDLER
  document.getElementById('signUpForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const fullName = document.getElementById('fullName').value;
    const signUpEmail = document.getElementById('signUpEmail').value;
    const signUpPassword = document.getElementById('signUpPassword').value;
    const userRole = document.getElementById('userRole').value;
    fetch('http://localhost:8080/api/users/signup', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        name: fullName,
        email: signUpEmail,
        password: signUpPassword,
        role: userRole
      })
    })
    .then(response => {
      if (response.ok) return response.json();
      else throw new Error('Signup failed');
    })
    .then(() => {
      alert('‚úÖ Account created successfully! Please log in.');
      showLogin(); // show login form
    })
    .catch(error => {
      console.error('Signup error:', error);
      alert('‚ùå Signup failed.');
    });
  });

  //search bar
  function handleSearch() {
    const location = document.getElementById('location').value;
    const checkIn = document.getElementById('check-in').value;
    const checkOut = document.getElementById('check-out').value;
    const person = document.getElementById('person').value;
    const today = new Date();
    today.setHours(0, 0, 0, 0); // strip time part
    const checkInDate = new Date(checkIn);
    const checkOutDate = new Date(checkOut);
    // ‚úÖ Prevent past check-in
    if (checkIn && checkInDate < today) {
      alert('‚ùå Check-in date cannot be in the past.');
      return;
    }
    // ‚úÖ Prevent check-out before check-in
    if (checkIn && checkOut && checkOutDate < checkInDate) {
      alert('‚ùå Check-out date cannot be before check-in date.');
      return;
    }
    // ‚úÖ Save + continue to fetch
    localStorage.setItem('searchFormData', JSON.stringify({
      location,
      checkIn,
      checkOut,
      person
    }));
    fetch(`http://localhost:8080/api/housing/search?location=${encodeURIComponent(location)}&checkIn=${checkIn}&checkOut=${checkOut}&person=${person}`)
      .then(response => response.json())
      .then(results => {
        localStorage.setItem('searchResults', JSON.stringify(results));
        window.location.href = 'house_selection.html';
      })
      .catch(error => {
        console.error('Search error:', error);
        alert('‚ùå Error fetching housing results');
      });
  }
  window.handleSearch = handleSearch;

  // Forgot Password Modal Logic
  const forgotPasswordLink = document.getElementById('forgotPasswordLink');
  const forgotPasswordModal = document.getElementById('forgotPasswordModal');
  const closeForgotModal = document.getElementById('closeForgotModal');
  const forgotPasswordForm = document.getElementById('forgotPasswordForm');
  const forgotPasswordMessage = document.getElementById('forgotPasswordMessage');

  forgotPasswordLink.onclick = function(e) {
    e.preventDefault();
    forgotPasswordModal.style.display = 'block';
    forgotPasswordMessage.textContent = '';
    document.getElementById('forgotEmail').value = '';
  };
  closeForgotModal.onclick = function() {
    forgotPasswordModal.style.display = 'none';
  };
  window.addEventListener('click', function(event) {
    if (event.target === forgotPasswordModal) {
      forgotPasswordModal.style.display = 'none';
    }
  });
  forgotPasswordForm.onsubmit = function(e) {
    e.preventDefault();
    const email = document.getElementById('forgotEmail').value;
    forgotPasswordMessage.textContent = 'Sending reset link...';
    fetch('/api/auth/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    })
    .then(res => {
      forgotPasswordMessage.textContent = 'If your email is registered, a password reset link has been sent.';
      forgotPasswordForm.reset();
    })
    .catch(() => {
      forgotPasswordMessage.textContent = 'If your email is registered, a password reset link has been sent.';
    });
  };

  var forgotModal = document.getElementById('forgotPasswordModal');
  if (forgotModal) forgotModal.style.display = 'none';
});
</script>

</body>
</html>
